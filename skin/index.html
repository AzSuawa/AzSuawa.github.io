<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8 /><meta name=viewport content="width=device-width, initial-scale=1.0" /><title>上传皮肤到服务器 - 素素の生存服(p≧w≦q)</title><meta name=description content="上传皮肤到服务器 - 素素の生存服、azsu.top、小小素QQ机器人" /><meta name=theme-color content=#A1BDFF /><link rel=stylesheet href=/css/all.min.css /><link rel=stylesheet href=/css/style.css /><link rel=icon href=/images/favicon.ico /><style>.skin-upload-container{max-width:500px;margin:0 auto}.skin-drop-area{border:2px dashed #6c757d;border-radius:6px;padding:30px;text-align:center;margin-bottom:20px;transition:all .3s;background:#f8f9fa}.skin-drop-area.highlight{border-color:#28a745;background:#e8f5e9}.skin-btn{background:var(--primary-color);color:#fff;padding:10px 20px;border:none;border-radius:4px;cursor:pointer;font-size:16px;margin:10px 5px;transition:background-color .3s}.skin-btn:hover{background:#8caeff}.skin-progress-container{margin-top:20px;display:none}.skin-progress{width:100%;height:20px;border-radius:4px}.skin-file-list{margin-top:20px;max-height:300px;overflow-y:auto}.skin-file-item{display:flex;justify-content:space-between;padding:10px;border-bottom:1px solid #eee;align-items:center}.skin-file-info{display:flex;align-items:center}.skin-file-icon{margin-right:10px;color:#6c757d}.skin-file-status{font-weight:bold}.skin-status-pending{color:#ffc107}.skin-status-success{color:#28a745}.skin-status-error{color:#dc3545}.skin-form-group{margin-bottom:15px}.skin-form-group label{display:block;margin-bottom:5px;font-weight:bold}.skin-form-group input{width:calc(100% - 2px);padding:10px;border:1px solid #ced4da;border-radius:4px;font-size:14px;box-sizing:border-box}.skin-file-size-limit{color:#6c757d;font-size:14px;margin-top:5px}.skin-preview-link{color:#007bff;text-decoration:none;margin-left:10px}.skin-preview-link:hover{text-decoration:underline}#fileInput{display:none}.captcha-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:none;z-index:999}.captcha-card{background:var(--card-bg);border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,.15);width:100%;max-width:380px;overflow:hidden;display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1000}.captcha-card-header{padding:16px 20px;border-bottom:1px solid var(--border-color);position:relative}.captcha-card-title{font-size:18px;font-weight:bold;margin:0 0 6px 0;color:var(--text-color)}.captcha-cueword{font-weight:bold;color:var(--primary-color)}.captcha-verification-container{padding:8px 16px 8px}.captcha-image-wrapper{width:100%;margin:8px 0 12px;position:relative}.captcha-image-container{position:relative;width:100%;padding-top:100%;overflow:hidden;border:2px solid var(--border-color);border-radius:4px;background:#f9f9f9}.captcha-image-container img{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover}.captcha-grid-overlay{position:absolute;top:0;left:0;width:100%;height:100%;display:grid;grid-template-columns:repeat(4,1fr);grid-template-rows:repeat(4,1fr)}.captcha-grid-cell{border:2px solid rgba(0,0,0,.3);transition:all .2s;cursor:pointer;box-sizing:border-box}.captcha-grid-cell:hover{background:var(--hover-bg)}.captcha-grid-cell.selected{background:rgba(161,189,255,.4);border-color:var(--primary-color)}.captcha-card-footer{display:flex;justify-content:space-between;align-items:center;padding:12px 20px;border-top:1px solid var(--border-color)}.captcha-footer-text{font-size:14px;color:#999}.captcha-btn{background:var(--primary-color);color:#fff;border:none;border-radius:4px;padding:6px 14px;font-size:14px;cursor:pointer;transition:background-color .2s}.captcha-btn:hover{background:var(--hover-blue)}.captcha-btn:disabled{background:#ccc;cursor:not-allowed}.captcha-btn-cancel{background:#f1f1f1;color:#666;margin-right:8px}.captcha-btn-cancel:hover{background:#e5e5e5}.captcha-loading{opacity:.6;pointer-events:none}.captcha-success-message,.captcha-error-message{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.7);color:#fff;padding:16px 24px;border-radius:4px;font-weight:bold;display:none;z-index:1001}.captcha-error-message{max-width:300px;text-align:center}.captcha-close-btn{position:absolute;top:12px;right:12px;background:none;border:none;font-size:20px;cursor:pointer;color:#999}.captcha-close-btn:hover{color:#333}.card{display:block!important}</style></head><body><div id=header><button id=menu-btn><i class="fas fa-bars"></i></button> <div id=title>素素の生存服</div></div><div id=sidebar></div><div id=content><div class="card active"><h1>上传皮肤到服务器</h1><div class="command-section skin-upload-container"><div class=skin-form-group><label for=playerId>玩家ID:</label><input type=text id=playerId placeholder=请输入你的游戏名 required /></div><div class=skin-drop-area id=dropArea><p>可拖放文件到此处</p><button class=skin-btn id=selectBtn>选择文件</button><input type=file id=fileInput accept=image/png /><div class=skin-file-size-limit>仅支持原版皮肤(PNG,64×64)</div></div><div class=skin-progress-container id=progressContainer><p id=statusText>准备上传...</p><progress class=skin-progress id=uploadProgress value=0 max=100></progress></div><div class=skin-file-list id=fileList></div></div></div></div><div class=captcha-overlay id=captchaOverlay></div><div class=captcha-card id=captchaCard><div class=captcha-card-header><h2 class=captcha-card-title>请选择所有包含<span id=cueword class=captcha-cueword>加载中</span>的内容</h2><button class=captcha-close-btn id=captchaCloseBtn>×</button></div><div class=captcha-verification-container><div class=captcha-image-wrapper><div class=captcha-image-container><img id=captchaImage alt=验证图片 style=display:none /><div class=captcha-grid-overlay id=captchaGridOverlay></div><div id=captchaCenterMessage>正在初始化...</div></div></div></div><div class=captcha-card-footer><span class=captcha-footer-text>By 阿素本素</span><div> <button class="captcha-btn captcha-btn-cancel" id=captchaCancelBtn>取消</button> <button class=captcha-btn id=captchaSubmitBtn disabled>继续</button></div></div></div><div class=captcha-success-message id=captchaSuccessMessage>验证成功！</div><div class=captcha-error-message id=captchaErrorMessage><div id=captchaErrorText></div></div><script src=/js/main.js></script><script>function preventDefaults(n){n.preventDefault();n.stopPropagation()}function handleDrop(n){const t=n.dataTransfer.files;handleFiles(t)}function handleFiles(n){fileList.innerHTML="";const u=playerIdInput.value.trim();if(!u){showError("请先输入玩家ID(p≧w≦q)");return}const t=Array.from(n).filter(n=>n.type==="image/png");if(t.length===0){showError("请选择PNG格式的皮肤文件(p≧w≦q)");return}const f=t.filter(n=>n.size>10240);if(f.length>0){showError(`文件 "${f[0].name}" 超过10KB限制(p≧w≦q)`);return}const i=t[0],r=new Image;r.onload=function(){if(this.width!==64||this.height!==64){showError("皮肤图片尺寸必须是64x64像素(p≧w≦q)");return}const n=document.createElement("div");n.className="skin-file-item";n.innerHTML=`<div class="skin-file-info"><span class="skin-file-icon">📄</span><span>${i.name} (${formatFileSize(i.size)})</span></div><span class="skin-file-status skin-status-pending">等待验证</span>`;fileList.appendChild(n);pendingFiles=t;pendingPlayerId=u;startCaptchaVerification()};r.onerror=function(){showError("无法读取图片文件(p≧w≦q)")};r.src=URL.createObjectURL(i)}function startCaptchaVerification(){showCaptcha();initVerification()}function showCaptcha(){captchaCard.style.display="block";captchaOverlay.style.display="block"}function hideCaptcha(){captchaCard.style.display="none";captchaOverlay.style.display="none"}async function initVerification(){try{setCaptchaLoading(!0);updateCenterMessage("正在初始化...");clearCaptchaToken();const t=await fetch("https://api.azsu.top/5002/captcha/get_token"),n=await t.json();n.code===1e4?(currentToken=n.data.captcha_token,updateCenterMessage("正在加载验证图片..."),await loadCaptchaImage()):(showCaptchaError("获取验证令牌失败: "+n.message),setCaptchaLoading(!1),hideCaptcha())}catch(n){showCaptchaError("初始化验证失败: "+n.message);setCaptchaLoading(!1);hideCaptcha()}}async function loadCaptchaImage(){try{const t=await fetch(`https://api.azsu.top/5001/captcha?captcha_token=${currentToken}`),n=await t.json();n.code===16001||n.code===1e4?(n.data.image_base64&&(captchaImage.src="data:image/jpeg;base64,"+n.data.image_base64,captchaImage.style.display="block",hideCenterMessage()),n.data.cueword&&(cuewordElement.textContent=n.data.cueword),setCaptchaLoading(!1)):(showCaptchaError("加载验证图片失败: "+n.message),setCaptchaLoading(!1),hideCaptcha())}catch(n){showCaptchaError("加载验证图片失败: "+n.message);setCaptchaLoading(!1);hideCaptcha()}}async function submitCaptcha(){if(!verificationInProgress&&selectedCells.length!==0){verificationInProgress=!0;captchaSubmitBtn.disabled=!0;setCaptchaLoading(!0);updateCenterMessage("正在验证...");try{const t=await fetch(`https://api.azsu.top/5001/captcha?captcha_token=${currentToken}&selected_cells=${JSON.stringify(selectedCells)}`),n=await t.json();n.code===16002||n.code===1e4&&n.data.status==="success"?(hideCaptcha(),setTimeout(()=>{showCaptchaSuccess(),storeCaptchaToken(currentToken),setTimeout(()=>{resetCaptchaSelection(),uploadFile(pendingFiles[0],pendingPlayerId)},1e3)},10)):n.code===16001&&n.data.status==="processing"?(updateCenterMessage("正在加载验证图片..."),n.data.image_base64&&(captchaImage.src="data:image/jpeg;base64,"+n.data.image_base64),n.data.cueword&&(cuewordElement.textContent=n.data.cueword),resetCaptchaSelection(),setCaptchaLoading(!1)):(showCaptchaError("验证失败: "+(n.message||"未知错误")),setCaptchaLoading(!1))}catch(n){showCaptchaError("验证请求失败: "+n.message);setCaptchaLoading(!1)}finally{verificationInProgress=!1}}}function cancelCaptcha(){hideCaptcha();resetCaptchaSelection();pendingFiles=null;pendingPlayerId="";fileList.innerHTML=""}function resetCaptchaSelection(){selectedCells=[];document.querySelectorAll(".captcha-grid-cell.selected").forEach(n=>{n.classList.remove("selected")});captchaSubmitBtn.disabled=!0}function setCaptchaLoading(n){n?captchaCard.classList.add("captcha-loading"):captchaCard.classList.remove("captcha-loading");verificationInProgress=n}function updateCenterMessage(n){captchaCenterMessage.textContent=n}function hideCenterMessage(){captchaCenterMessage.textContent=""}function showCaptchaSuccess(){captchaSuccessMessage.style.display="block";setTimeout(()=>{captchaSuccessMessage.style.display="none"},1e3)}function showCaptchaError(n){captchaErrorText.textContent=n;captchaErrorMessage.style.display="block";setTimeout(()=>{captchaErrorMessage.style.display="none"},3e3)}function storeCaptchaToken(n){localStorage.setItem("captcha_token",n);localStorage.setItem("captcha_token_expires",(Math.floor(Date.now()/1e3)+240).toString())}function clearCaptchaToken(){localStorage.removeItem("captcha_token");localStorage.removeItem("captcha_token_expires")}function uploadFile(n,t){progressContainer.style.display="block";statusText.textContent="准备上传...";statusText.style.color="";uploadProgress.value=0;const r=new FormData;r.append("file",n);r.append("player_id",t);r.append("captcha_token",currentToken);const i=new XMLHttpRequest;i.open("POST","https://api.azsu.top:5003/skin/upload",!0);i.setRequestHeader("Accept","application/json");i.upload.onprogress=function(n){if(n.lengthComputable){const t=Math.round(n.loaded/n.total*100);uploadProgress.value=t;statusText.textContent=`上传中: ${t}%`;const i=document.querySelector(".skin-file-item");i.querySelector(".skin-file-status").textContent=`${t}%`;i.querySelector(".skin-file-status").className="skin-file-status skin-status-pending"}};i.onload=function(){const n=document.querySelector(".skin-file-item");if(i.status===200||i.status===400)try{const r=JSON.parse(i.responseText);r.code===14e3?(statusText.textContent="文件上传成功(p≧w≦q)",statusText.style.color="#28a745",uploadProgress.value=100,updateFileStatus(n,"上传成功","success"),addPreviewLink(n,t)):(statusText.textContent=r.message||"上传失败",statusText.style.color="#dc3545",updateFileStatus(n,r.message||"上传失败","error"))}catch(r){statusText.textContent="服务器响应异常";statusText.style.color="#dc3545";updateFileStatus(n,"服务器异常","error")}else statusText.textContent=`上传失败 (${i.status})`,statusText.style.color="#dc3545",updateFileStatus(n,`失败: ${i.status}`,"error");fileInput.value="";pendingFiles=null;pendingPlayerId=""};i.onerror=function(){statusText.textContent="网络错误(p≧w≦q)";statusText.style.color="#dc3545";const n=document.querySelector(".skin-file-item");updateFileStatus(n,"网络错误","error");fileInput.value="";pendingFiles=null;pendingPlayerId=""};i.send(r)}function updateFileStatus(n,t,i){const r=n.querySelector(".skin-file-status");r.textContent=t;r.className=`skin-file-status skin-status-${i}`}function addPreviewLink(n,t){const i=document.createElement("a");i.href="https://api.azsu.top/skin/file?player="+t;i.textContent="查看皮肤";i.className="skin-preview-link";i.target="_blank";n.appendChild(i)}function showError(n){statusText.textContent=n;statusText.style.color="#dc3545";progressContainer.style.display="block"}function formatFileSize(n){if(n===0)return"0 Bytes";const t=1024,i=Math.floor(Math.log(n)/Math.log(t));return parseFloat((n/Math.pow(t,i)).toFixed(2))+" "+["Bytes","KB","MB","GB"][i]}const dropArea=document.getElementById("dropArea"),fileInput=document.getElementById("fileInput"),selectBtn=document.getElementById("selectBtn"),progressContainer=document.getElementById("progressContainer"),uploadProgress=document.getElementById("uploadProgress"),statusText=document.getElementById("statusText"),fileList=document.getElementById("fileList"),playerIdInput=document.getElementById("playerId"),captchaOverlay=document.getElementById("captchaOverlay"),captchaCard=document.getElementById("captchaCard"),captchaGridOverlay=document.getElementById("captchaGridOverlay"),captchaSubmitBtn=document.getElementById("captchaSubmitBtn"),captchaCancelBtn=document.getElementById("captchaCancelBtn"),captchaCloseBtn=document.getElementById("captchaCloseBtn"),captchaImage=document.getElementById("captchaImage"),cuewordElement=document.getElementById("cueword"),captchaCenterMessage=document.getElementById("captchaCenterMessage"),captchaSuccessMessage=document.getElementById("captchaSuccessMessage"),captchaErrorMessage=document.getElementById("captchaErrorMessage"),captchaErrorText=document.getElementById("captchaErrorText");let selectedCells=[],currentToken="",verificationInProgress=!1,pendingFiles=null,pendingPlayerId="";for(let n=0;n<16;n++){const t=document.createElement("div");t.className="captcha-grid-cell";t.dataset.index=n;t.addEventListener("click",function(){if(!verificationInProgress){this.classList.toggle("selected");const n=parseInt(this.dataset.index);this.classList.contains("selected")?selectedCells.includes(n)||selectedCells.push(n):selectedCells=selectedCells.filter(t=>t!==n);captchaSubmitBtn.disabled=selectedCells.length===0}});captchaGridOverlay.appendChild(t)}selectBtn.addEventListener("click",()=>{fileInput.click()});fileInput.addEventListener("change",()=>{handleFiles(fileInput.files)});["dragenter","dragover","dragleave","drop"].forEach(n=>{dropArea.addEventListener(n,preventDefaults,!1)});["dragenter","dragover"].forEach(n=>{dropArea.addEventListener(n,()=>dropArea.classList.add("highlight"),!1)});["dragleave","drop"].forEach(n=>{dropArea.addEventListener(n,()=>dropArea.classList.remove("highlight"),!1)});dropArea.addEventListener("drop",handleDrop,!1);captchaSubmitBtn.addEventListener("click",submitCaptcha);captchaCancelBtn.addEventListener("click",cancelCaptcha);captchaCloseBtn.addEventListener("click",cancelCaptcha)</script></body></html>