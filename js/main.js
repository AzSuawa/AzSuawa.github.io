const menuData=[{name:"素素の生存服",items:[{href:"/ba/",page:"home",icon:"home",text:"首页"},{href:"/mechanisms/",page:"mechanisms",icon:"list-alt",text:"机制修改"},{href:"/sp/",page:"sp",icon:"heart",text:"赞助列表"},{href:"/ban/",page:"ban",icon:"ban",text:"封禁列表"},{href:"/skin/",page:"skin",icon:"star",text:"上传皮肤"}]},{name:"小小素BOT",items:[{href:"/aa/",page:"aa",icon:"home",text:"首页"},{href:"/api/",page:"api",icon:"code",text:"API"},{href:"/ab/",page:"ab",icon:"star",text:"常见问题"},{href:"/ac/",page:"ac",icon:"heart",text:"鸣谢和赞助"},{href:"/cmds/",page:"cmds",icon:"list-alt",text:"指令列表"},{href:"/bot-update/",page:"bot-update",icon:"book",text:"更新日志"},{href:"/mcp/",page:"mcp",icon:"star",text:"MCPing"}]},{name:"其他",active:false,items:[{href:"/wiki/cape/",page:"cape",icon:"star",text:"如何兑换Minecraft披风"},{href:"https://azsu.top/wiki/api-auth/",page:"api-auth",icon:"star",text:"认证请求调用方式"},{href:"/wiki/cross-version/",page:"cross-version",icon:"star",text:"如何使用不支持的版本加入素素の生存服"}]}];function getMenuHTML(){return menuData.map(e=>`<div class="menu-group ${e.active!==false?"active":""}"><div class="group-header"><i class="fas fa-star"></i><span>${e.name}</span><i class="fas fa-chevron-${e.active!==false?"down":"right"} toggle"></i></div><ul class="submenu" ${e.active===false?'style="display:none"':""}>${e.items.map(t=>`<li><a href="${t.href}" data-page="${t.page}"><i class="fas fa-${t.icon}"></i> ${t.text}</a></li>`).join("")}</ul></div>`).join("")}const specialPages={skin:1,mcp:1};const redirectRules={"/bb":"/mechanisms","/ban-sudpkkkk":"/ban/sudpkkkk","/#mcp":"/mcp","/bot/update":"/bot-update"};let menuState={expandedGroups:["素素の生存服","小小素BOT"]};let router={currentPage:null,isLoading:false};const isSubPage=()=>{const e=location.pathname;return e!=="/"&&e!=="/index.html"&&!e.endsWith(".html")};const getCurrentPageId=()=>{const e=location.pathname+location.hash;let t=e.replace(/^\/|\/$/g,"");return t=t.replace(/\.html$/,""),t===""||t==="index.html"?"home":t};const getPageIdFromHref=e=>{if(e==="/"||e==="")return"home";let t=e.replace(/^\/|\/$/g,"");return t=t.replace(/\.html$/,""),t||"home"};const isSpecialPage=e=>specialPages[e]||e.startsWith("wiki/");const buildPageUrl=e=>e==="home"?"/":`/${e}/`;const buildPageRequestUrl=e=>{if(e==="home")return"/index.html";const t=e.split("/");return t.length>1?`/${e}/index.html`:`/${e}/index.html`};function checkAndRedirect(){const e=location.pathname+location.hash,t=redirectRules[e];if(t)return history.replaceState({},"",t),location.href=t,!0;for(const n in redirectRules){const o=n.replace(/^\//,"");if(e.includes(o)&&e!==n){const a=redirectRules[n];return history.replaceState({},"",a),location.href=a,!0}}return!1}function saveMenuState(){const e=[];document.querySelectorAll(".menu-group.active").forEach(t=>{e.push(t.querySelector(".group-header span").textContent)}),menuState.expandedGroups=e,sessionStorage.setItem("menuState",JSON.stringify(menuState))}function restoreMenuState(){const e=sessionStorage.getItem("menuState");if(e){menuState=JSON.parse(e);document.querySelectorAll(".menu-group").forEach(t=>{const n=t.querySelector(".group-header span").textContent,o=t.querySelector(".submenu"),a=t.querySelector(".toggle"),s=menuState.expandedGroups.includes(n);t.classList.toggle("active",s),o&&(o.style.display=s?"block":"none"),a&&(a.className=`fas fa-chevron-${s?"down":"right"} toggle`)})}}function toggleSidebar(){const e=document.getElementById("sidebar"),t=document.getElementById("content");e&&t&&(e.classList.toggle("active"),t.classList.toggle("shifted"))}function initMenuButton(){const e=document.getElementById("menu-btn");e&&e.addEventListener("click",toggleSidebar)}function ensureDynamicContentContainer(){let e=document.getElementById("dynamic-content");if(!e){e=document.createElement("div");e.id="dynamic-content";const t=document.querySelector("#content .container")||document.querySelector("#content")||document.body;t.appendChild(e)}return e}function initMenu(){const e=document.getElementById("sidebar");if(e){e.innerHTML=getMenuHTML(),e.style.overflowY="auto",e.style.maxHeight="calc(100vh - 60px)";document.querySelectorAll(".group-header").forEach(e=>{e.addEventListener("click",function(){const e=this.parentElement,t=this.nextElementSibling,n=this.querySelector(".toggle");e.classList.toggle("active");const o=e.classList.contains("active");t&&(t.style.display=o?"block":"none"),n&&(n.className=`fas fa-chevron-${o?"down":"right"} toggle`),saveMenuState()})});document.querySelectorAll('#sidebar a[href^="/"]').forEach(e=>{e.addEventListener("click",function(e){const t=this.getAttribute("href"),n=getPageIdFromHref(t),o=Object.keys(specialPages).some(e=>n===e||n.startsWith(e+"/"));if(o)return!0;isSubPage()||(e.preventDefault(),handleSPANavigation(n,buildPageUrl(n))),window.innerWidth<=1023&&toggleSidebar()})})}}function setActiveMenuItem(e){document.querySelectorAll("#sidebar li").forEach(t=>t.classList.remove("active"));const t=document.querySelector(`[data-page="${e}"]`)||document.querySelector(`a[href="${e==="home"?"/":"/"+e+"/"}"]`);t&&t.parentElement.classList.add("active")}function handleSPANavigation(e,t){if(checkAndRedirect())return;const n=window.router||router;if(n.currentPage===e||n.isLoading)return;console.log("SPA导航到页面:",e),"home"===e?(history.pushState({pageId:"home"},null,"/"),showHomeContent(),n.currentPage="home"):(history.pushState({pageId:e},null,t),loadPageContent(e,n),n.currentPage=e);setActiveMenuItem(e),saveMenuState()}function showHomeContent(){const e=ensureDynamicContentContainer();e.innerHTML="";const t=document.querySelectorAll(".card");t.length>0?t.forEach(e=>e.style.display="block"):e.innerHTML='<div class="card active"><h1>遇到BUG了？</h1><p>啊这。。。</p></div>',window.scrollTo(0,0)}async function loadPageContent(e,t){if(t.isLoading)return;t.isLoading=!0;const n=ensureDynamicContentContainer();n.innerHTML='<div class="card active"><div class="loading"><p>加载中...</p></div></div>',document.querySelectorAll(".card").forEach(e=>e.style.display="none");try{const o=await fetch(buildPageRequestUrl(e));if(!o.ok)throw new Error(`HTTP错误! 状态码: ${o.status}`);const a=await o.text(),s=document.createElement("div");s.innerHTML=a;const r=s.querySelector("#content")||s.querySelector("main")||s.querySelector(".container")||s.querySelector(".content");n.innerHTML=r?r.innerHTML:a,setActiveMenuItem(e),window.scrollTo(0,0)}catch(o){n.innerHTML=`<div class="card active error"><h1>加载失败QAQ</h1><div class="command-section"><p>${o.message}</p><p>ID: ${e}</p><div style="margin-top:15px"><button onclick="location.reload()" style="margin:5px;padding:6px 15px;background:#A1BDFF;color:white;border:none;border-radius:4px;cursor:pointer;font-size:15px">刷新</button></div></div></div>`}t.isLoading=!1}function initRouter(e){if(checkAndRedirect())return;window.router=e;const t=getCurrentPageId();e.currentPage=t;if("/"===location.pathname||""===location.pathname||"/index.html"===location.pathname)showHomeContent(),e.currentPage="home";else if("home"!==t&&!isSpecialPage(t)){loadPageContent(t,e);e.currentPage=t}window.addEventListener("popstate",function(t){if(checkAndRedirect())return;let n=t.state&&t.state.pageId?t.state.pageId:getCurrentPageId();if(e.currentPage===n)return;if(isSpecialPage(n))return void(location.href=buildPageUrl(n));"home"===n?(showHomeContent(),e.currentPage="home"):(loadPageContent(n,e),e.currentPage=n),setActiveMenuItem(n),restoreMenuState()})}function initializePage(){if(checkAndRedirect())return;const allowedDomains=['azsu.top','localhost','127.0.0.1','api.azsu.top','github.azsu.top','www.azsu.top'];const currentDomain=window.location.hostname;if(!allowedDomains.includes(currentDomain)){const correctUrl='https://azsu.top'+window.location.pathname+window.location.search+window.location.hash;window.location.href=correctUrl;return;}const e=getCurrentPageId();router.currentPage=e,ensureDynamicContentContainer(),initMenu(),initMenuButton(),setActiveMenuItem(e),restoreMenuState(),isSpecialPage(e)||isSubPage()||initRouter(router)}document.addEventListener("DOMContentLoaded",initializePage),window.addEventListener("resize",function(){const e=document.getElementById("sidebar"),t=document.getElementById("content");e&&t&&window.innerWidth>1023&&(e.classList.remove("active"),t.classList.remove("shifted"))});function initCodeCopy(){document.querySelectorAll('.code-copy-btn').forEach(e=>{e.addEventListener('click',function(){const e=this.closest('.code-container').querySelector('code'),t=e.textContent;navigator.clipboard.writeText(t).then(()=>{const e=this.querySelector('span'),t=e.textContent;e.textContent='已复制',setTimeout(()=>{e.textContent=t},2e3)}).catch(()=>{const e=this.querySelector('span'),t=e.textContent;e.textContent='复制失败',setTimeout(()=>{e.textContent=t},2e3)})})})}initCodeCopy();
