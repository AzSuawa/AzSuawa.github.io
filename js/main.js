// 精简版菜单数据
const menuData=[{name:"素素の生存服",items:[{href:"/ba/",page:"home",icon:"home",text:"首页"},{href:"/bb/",page:"bb",icon:"list-alt",text:"机制修改"},{href:"/sp/",page:"sp",icon:"heart",text:"赞助列表"},{href:"/ban/",page:"ban",icon:"ban",text:"封禁列表"},{href:"/skin/",page:"skin",icon:"star",text:"上传皮肤"}]},{name:"小小素BOT",items:[{href:"/aa/",page:"aa",icon:"home",text:"首页"},{href:"/api/",page:"api",icon:"code",text:"API"},{href:"/ab/",page:"ab",icon:"star",text:"常见问题"},{href:"/ac/",page:"ac",icon:"heart",text:"鸣谢和赞助"},{href:"/cmds/",page:"cmds",icon:"list-alt",text:"指令列表"},{href:"/bot-update/",page:"bot-update",icon:"book",text:"更新日志"},{href:"/mcp/",page:"mcp",icon:"star",text:"MCPing"}]},{name:"其他",active:false,items:[{href:"/wikl/cape/",page:"cape",icon:"star",text:"如何兑换Minecraft披风"},{href:"/g/",page:"g",icon:"book",text:"测试页面"}]}];function getMenuHTML(){return menuData.map(e=>`<div class="menu-group ${e.active!==false?"active":""}"><div class="group-header"><i class="fas fa-star"></i><span>${e.name}</span><i class="fas fa-chevron-${e.active!==false?"down":"right"} toggle"></i></div><ul class="submenu" ${e.active===false?'style="display:none"':""}>${e.items.map(t=>`<li><a href="${t.href}" data-page="${t.page}"><i class="fas fa-${t.icon}"></i> ${t.text}</a></li>`).join("")}</ul></div>`).join("")}const specialPages={skin:1,mcp:1,"wikl/cape":1};let menuState={expandedGroups:["素素の生存服","小小素BOT"]};let router={currentPage:null,isLoading:false};const isSubPage=()=>{const e=location.pathname;return e!=="/"&&e!=="/index.html"&&!e.endsWith(".html")};const getCurrentPageId=()=>{const e=location.pathname.replace(/^\/|\/$/g,"");return e===""||e==="index.html"?"home":e};const getPageIdFromHref=e=>e==="/"||e===""?"home":e.replace(/^\/|\/$/g,"");const isSpecialPage=e=>Object.keys(specialPages).some(t=>e===t||e.startsWith(t+"/"));const buildPageUrl=e=>e==="home"?"/":`/${e}/`;const buildPageRequestUrl=e=>e==="home"?"/index.html":`/${e}/index.html`;function saveMenuState(){const e=[];document.querySelectorAll(".menu-group.active").forEach(t=>{e.push(t.querySelector(".group-header span").textContent)}),menuState.expandedGroups=e,sessionStorage.setItem("menuState",JSON.stringify(menuState))}function restoreMenuState(){const e=sessionStorage.getItem("menuState");if(e){menuState=JSON.parse(e);document.querySelectorAll(".menu-group").forEach(t=>{const s=t.querySelector(".group-header span").textContent,c=t.querySelector(".submenu"),a=t.querySelector(".toggle"),n=menuState.expandedGroups.includes(s);t.classList.toggle("active",n),c&&(c.style.display=n?"block":"none"),a&&(a.className=`fas fa-chevron-${n?"down":"right"} toggle`)})}}function toggleSidebar(){const e=document.getElementById("sidebar"),t=document.getElementById("content");e&&t&&(e.classList.toggle("active"),t.classList.toggle("shifted"))}function initMenuButton(){const e=document.getElementById("menu-btn");e&&e.addEventListener("click",toggleSidebar)}function ensureDynamicContentContainer(){let e=document.getElementById("dynamic-content");if(!e){e=document.createElement("div");e.id="dynamic-content";const t=document.querySelector("#content .container")||document.querySelector("#content")||document.body;t.appendChild(e)}return e}function initMenu(){const e=document.getElementById("sidebar");if(e){e.innerHTML=getMenuHTML(),e.style.overflowY="auto",e.style.maxHeight="calc(100vh - 60px)",document.querySelectorAll(".group-header").forEach(t=>{t.addEventListener("click",function(){const e=this.parentElement,t=this.nextElementSibling,s=this.querySelector(".toggle");e.classList.toggle("active");const c=e.classList.contains("active");t&&(t.style.display=c?"block":"none"),s&&(s.className=`fas fa-chevron-${c?"down":"right"} toggle`),saveMenuState()})}),document.querySelectorAll('#sidebar a[href^="/"]').forEach(t=>{t.addEventListener("click",function(e){const s=this.getAttribute("href"),c=getPageIdFromHref(s),a=Object.keys(specialPages).some(e=>c===e||c.startsWith(e+"/"));if(a)return!0;isSubPage()||(e.preventDefault(),handleSPANavigation(c,buildPageUrl(c))),window.innerWidth<=1023&&toggleSidebar()})})}}function setActiveMenuItem(e){document.querySelectorAll("#sidebar li").forEach(t=>t.classList.remove("active"));const t=document.querySelector(`[data-page="${e}"]`)||document.querySelector(`a[href="${e==="home"?"/":"/"+e+"/"}"]`);t&&t.parentElement.classList.add("active")}function handleSPANavigation(e,t){const s=window.router||router;if(s.currentPage===e||s.isLoading)return;console.log("SPA导航到页面:",e),"home"===e?(history.pushState({pageId:"home"},null,"/"),showHomeContent(),s.currentPage="home"):(history.pushState({pageId:e},null,`/${e}/`),loadPageContent(e,s),s.currentPage=e),setActiveMenuItem(e),saveMenuState()}function showHomeContent(){const e=ensureDynamicContentContainer();e.innerHTML="";const t=document.querySelectorAll(".card");t.length>0?t.forEach(e=>e.style.display="block"):e.innerHTML='<div class="card active"><h1>遇到BUG了？</h1><p>啊这。。。</p></div>',window.scrollTo(0,0)}async function loadPageContent(e,t){if(t.isLoading)return;t.isLoading=!0;const s=ensureDynamicContentContainer();s.innerHTML='<div class="card active"><div class="loading"><p>加载中...</p></div></div>',document.querySelectorAll(".card").forEach(e=>e.style.display="none");try{const a=await fetch(buildPageRequestUrl(e));if(!a.ok)throw new Error(`HTTP错误! 状态码: ${a.status}`);const n=await a.text(),o=document.createElement("div");o.innerHTML=n;const i=o.querySelector("#content")||o.querySelector("main")||o.querySelector(".container")||o.querySelector(".content");s.innerHTML=i?i.innerHTML:n,setActiveMenuItem(e),window.scrollTo(0,0)}catch(a){s.innerHTML=`<div class="card active error"><h1>加载失败QAQ</h1><div class="command-section"><p>${a.message}</p><p>ID: ${e}</p><div style="margin-top:15px"><button onclick="location.reload()" style="margin:5px;padding:6px 15px;background:#A1BDFF;color:white;border:none;border-radius:4px;cursor:pointer;font-size:15px">刷新</button></div></div></div>`}t.isLoading=!1}function initRouter(e){window.router=e;const t=getCurrentPageId();e.currentPage=t,"/"===location.pathname||""===location.pathname||"/index.html"===location.pathname?(showHomeContent(),e.currentPage="home"):"home"!==t&&!isSpecialPage(t)&&(loadPageContent(t,e),e.currentPage=t),window.addEventListener("popstate",function(t){let s=t.state&&t.state.pageId?t.state.pageId:getCurrentPageId();if(e.currentPage!==s){if(isSpecialPage(s))return void location.href=buildPageUrl(s);"home"===s?(showHomeContent(),e.currentPage="home"):(loadPageContent(s,e),e.currentPage=s),setActiveMenuItem(s),restoreMenuState()}})}function initializePage(){const e=getCurrentPageId();router.currentPage=e,ensureDynamicContentContainer(),initMenu(),initMenuButton(),setActiveMenuItem(e),restoreMenuState(),isSpecialPage(e)||isSubPage()||initRouter(router)}document.addEventListener("DOMContentLoaded",initializePage),window.addEventListener("resize",function(){const e=document.getElementById("sidebar"),t=document.getElementById("content");e&&t&&window.innerWidth>1023&&(e.classList.remove("active"),t.classList.remove("shifted"))});